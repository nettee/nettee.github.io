<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="nettee 的 blog" type="application/atom+xml" />






<meta name="description" content="持续学习中...">
<meta property="og:type" content="website">
<meta property="og:title" content="nettee 的 blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="nettee 的 blog">
<meta property="og:description" content="持续学习中...">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="nettee 的 blog">
<meta name="twitter:description" content="持续学习中...">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>nettee 的 blog</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">nettee 的 blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Less is more than more.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2019/real-world-dynamic-programming-seam-carving/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2019/real-world-dynamic-programming-seam-carving/" itemprop="url">[译] 动态规划算法的实际应用：接缝裁剪</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-17T13:52:05+00:00">
                2019-11-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2019/real-world-dynamic-programming-seam-carving/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2019/real-world-dynamic-programming-seam-carving/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>这是我在<strong>掘金翻译计划</strong>中的译文。 译文链接：<a href="https://juejin.im/post/5de8b483f265da33d039c618" target="_blank" rel="noopener">[译] 动态规划算法的实际应用：接缝裁剪</a></p>
<blockquote>
<ul>
<li>原文地址：<a href="https://avikdas.com/2019/05/14/real-world-dynamic-programming-seam-carving.html" target="_blank" rel="noopener">Real-world dynamic programming: seam carving</a></li>
<li>原文作者：<a href="https://avikdas.com/" target="_blank" rel="noopener">Avik Das</a></li>
<li>译文出自：<a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">掘金翻译计划</a></li>
<li>本文永久链接：<a href="https://github.com/xitu/gold-miner/blob/master/TODO1/real-world-dynamic-programming-seam-carving.md" target="_blank" rel="noopener">https://github.com/xitu/gold-miner/blob/master/TODO1/real-world-dynamic-programming-seam-carving.md</a></li>
<li>译者：<a href="https://github.com/nettee" target="_blank" rel="noopener">nettee</a></li>
<li>校对者：<a href="https://github.com/JalanJiang" target="_blank" rel="noopener">JalanJiang</a>，<a href="https://github.com/TokenJan" target="_blank" rel="noopener">TokenJan</a></li>
</ul>
</blockquote>
<hr>
<p>我们一直认为动态规划（dynamic programming）是一个在学校里学习的技术，并且只是用来通过软件公司的面试。实际上，这是因为大多数的开发者不会经常处理需要用到动态规划的问题。本质上，<strong>动态规划可以高效求解那些可以分解为高度重复子问题的问题</strong>，因此在很多场景下是很有用的。</p>
<p>在这篇文章中，我将会仔细分析动态规划的一个有趣的实际应用：接缝裁剪（seam carving）。<a href="https://dl.acm.org/citation.cfm?id=1276390" target="_blank" rel="noopener">Avidan 和 Shamir 的这篇文章 <strong>Seam Carving for Content-Aware Image Resizing</strong></a> 中详细讨论了这个问题以及提出的技术（搜索文章的标题可以免费获取）。</p>
<p>这篇文章是动态规划的系列文章中的一篇。如果你还不了解动态规划技术，请参阅我写的<a href="https://medium.com/future-vision/a-graphical-introduction-to-dynamic-programming-2e981fa7ca2?source=friends_link&amp;sk=37cd14642cf1a83eb0bb33d231442837" target="_blank" rel="noopener">动态规划的图形化介绍</a>。</p>
<h2 id="环境敏感的图片大小调整"><a href="#环境敏感的图片大小调整" class="headerlink" title="环境敏感的图片大小调整"></a>环境敏感的图片大小调整</h2><p>为了用动态规划解决实际问题，我们需要将问题建模为可以应用动态规划的形式。本节介绍了这个问题的必要的准备工作。</p>
<p>论文的原作者介绍了一种在智能考虑图片内容的情况下改变图片的宽度或高度的方法，叫做环境敏感的图片大小调整（content-aware image resizing）。后面会介绍论文的细节，但这里先做一个概述。假设你想调整下面这个冲浪者图片的大小。</p>
<p><img src="/posts/2019/real-world-dynamic-programming-seam-carving/surfer.jpg" alt="一个冲浪者在平静的海面中间清晰可见的俯视图，右边是身后汹涌的海浪。图片来自 [Pixabay](https://pixabay.com/photos/blue-beach-surf-travel-surfer-4145659/) 上的 [Kiril Dobrev](https://pixabay.com/users/kirildobrev-12266114/)。"></p>
<p>论文中详细讨论了，有多种方法可以减少图片的宽度。我们最先想到的是裁剪和缩放，以及它们相关的缺点。删除图片中部的几列像素也是一种方法，但你也可以想象得到，这样会在图片中留下一条可见的分割线，左右的内容无法对齐。而且即使是这些方法全用上了，也只能删掉这么点图片：</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2019/real-world-dynamic-programming-seam-carving/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2019/How-to-write-a-simple-parser-in-hand/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2019/How-to-write-a-simple-parser-in-hand/" itemprop="url">如何手写一个简单的 parser</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-04T09:32:24+00:00">
                2019-08-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2019/How-to-write-a-simple-parser-in-hand/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2019/How-to-write-a-simple-parser-in-hand/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>前一阵子，收到烨兄的私聊，他突然要解决这样一个任务：</p>
<blockquote>
<p>做如下格式的表达式转换：</p>
<ul>
<li><code>Multi(a, Multi(b, c))  --&gt;  a * (b * c)</code></li>
<li><code>Divide(a, Sub(b, c))  --&gt; a / (b - c)</code></li>
</ul>
<p>支持的运算符有：</p>
<ul>
<li><code>Add</code>: +</li>
<li><code>Sub</code>: -</li>
<li><code>Multi</code>: *</li>
<li><code>Divide</code>: /</li>
</ul>
</blockquote>
<p>而且好死不死的需要用他没怎么用过的 C++ 来写。我发现这是一个 parser 的问题，第一反应是推荐他用 flex/bison，但想到为了这么大点任务大费周章不太合适，又开始想手写这样一个表达式的 parser 难不难。最后得出的结论是，不难。</p>
<p>了解编译原理的人都知道什么是 parser。Parser 中文名（语法）分析器，是每个编译器的前端都会有的一个东西。不过，从编译原理的视角来看，“语言”的范畴要比我们理解的编程语言要广义得多，任何有一定规则的字符串构成方式，都可以看成是语言，例如上面的那个任务里用 <code>Add</code>、<code>Sub</code> 这样的函数描述的表达式。</p>
<p>那么，要解决上面这个任务，只需要对表达式的字符串进行语法分析，得到一个中间表示（一般是分析树或抽象语法树），再将中间表示输出为所需的格式即可。也就是说我们需要为表达式提供一个 parser，这个任务的任何解决方式，本质上都可以看成是写了一个 parser。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2019/How-to-write-a-simple-parser-in-hand/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2019/Retries-Timeouts-and-Backoff/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2019/Retries-Timeouts-and-Backoff/" itemprop="url">[译] 重试、超时和退避</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-30T13:52:39+00:00">
                2019-07-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2019/Retries-Timeouts-and-Backoff/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2019/Retries-Timeouts-and-Backoff/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>这是我在<strong>掘金翻译计划</strong>中的译文。 译文链接：<a href="https://juejin.im/post/5ccf98ace51d456e6d133541" target="_blank" rel="noopener">[译] 分布式系统如何从故障中恢复？— 重试、超时和退避</a></p>
<blockquote>
<ul>
<li>原文地址：<a href="https://namc.in/2019-04-15-retries-timeouts-backoff" target="_blank" rel="noopener">Retries, Timeouts and Backoff</a></li>
<li>原文作者：<a href="http://namc.in/" target="_blank" rel="noopener">namc</a></li>
<li>译文出自：<a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">掘金翻译计划</a></li>
<li>本文永久链接：<a href="https://github.com/xitu/gold-miner/blob/master/TODO1/retries-timeouts-backoff.md" target="_blank" rel="noopener">https://github.com/xitu/gold-miner/blob/master/TODO1/retries-timeouts-backoff.md</a></li>
<li>译者：<a href="https://github.com/nettee" target="_blank" rel="noopener">nettee</a></li>
<li>校对者：<a href="https://github.com/fireairforce" target="_blank" rel="noopener">fireairforce</a></li>
</ul>
</blockquote>
<hr>
<p>分布式系统很难。即使我们学了很多构建高可用性系统的方法，也常常会忽略系统设计中的弹性（resiliency）。</p>
<p>我们肯定听说过容错性，但什么是“弹性”呢？个人而言，我喜欢将其定义为系统处理意外情况并最终从中恢复的能力。有很多方法使你的系统能从故障中回弹，但在这篇文章中，我们主要关注以下几点：</p>
<ul>
<li><a href="#超时">超时</a></li>
<li><a href="#重试">重试</a></li>
<li><a href="#退避">退避</a></li>
<li><a href="#分布式系统中的幂等性">分布式系统中的幂等性</a></li>
</ul>
<h2 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h2><p>简单来说，超时就是两个连续的数据包之间的最大不活动时间。</p>
<p>假设我们在某个时刻已经使用过了数据库驱动和 HTTP 客户端。所有帮助你的服务连接到一个外部服务器的客户端或驱动都有 Timeout 参数。这个参数通常默认为零或 -1，表示超时时间未定义，或是无限时间。</p>
<p>例如：参考 <code>connectTimeout</code> 和 <code>socketTimeout</code> 的定义 <a href="https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-configuration-properties.html" target="_blank" rel="noopener">Mysql Connector 配置</a></p>
<p>大多数对外部服务器的请求都附有一个超时时间。当外部服务器没有及时响应时，超时的设置非常有必要。如果没有设置超时，并使用默认值 0/-1，你的程序可能会阻塞几分钟或更长的时间。这是因为，当你没有收到来自应用服务器的响应，并且你的超时时间无限或非常大时，这个连接会一直开着。随着有更多的请求到来，更多的连接会打开，并永远无法关闭。这会导致你的连接池耗尽，进而导致你的应用的故障。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2019/Retries-Timeouts-and-Backoff/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2019/Monkey-inject-events-with-Automated-Network-Control/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2019/Monkey-inject-events-with-Automated-Network-Control/" itemprop="url">使用 Monkey 向 Android 设备精确发送事件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-20T16:35:01+00:00">
                2019-03-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2019/Monkey-inject-events-with-Automated-Network-Control/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2019/Monkey-inject-events-with-Automated-Network-Control/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://developer.android.com/studio/test/monkey" target="_blank" rel="noopener">Monkey</a> 是一个 Android 设备（模拟器或真实设备）上的一个程序，可以产生大量随机的用户输入事件，如点击、触摸、手势等。因此 Monkey 可用于 UI 上的压力测试。例如，下面的命令会启动一个特定的 app 并发送 500 个随机的事件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell monkey -p your.package.name -v 500</span><br></pre></td></tr></table></figure>
<p>然而，Monkey 程序还有一个特殊的 <code>--port</code> 选项。当这个选项开启后，Monkey 会运行在 <em>Automated Network Control</em> 模式下，可以精确地向 app 发送一些 <a href="https://developer.android.com/reference/android/view/KeyEvent.html" target="_blank" rel="noopener">KeyEvent</a> 和 <a href="https://developer.android.com/reference/android/view/MotionEvent" target="_blank" rel="noopener">MotionEvent</a>。这也提供了一种在 <code>adb shell input</code> 命令之外，程序性地发送用户事件的方法。关于 <code>adb shell input</code> 命令，可以参考<a href="https://stackoverflow.com/questions/7789826/adb-shell-input-events" target="_blank" rel="noopener">这里</a>。经测试，Monkey 支持的用户事件比 <code>input</code> 命令的用户事件更细致一些。例如 <code>input</code> 命令对 swipe 动作只能指定滑动时间，但 Monkey 可以细致地指定滑动中的多次手指移动。</p>
<p>如果你有 AOSP 源代码，可以在 <code>development/cmds/monkey/</code> 目录下找到 README.NETWORK.txt 文件，其中有说明 <em>Automated Network Control</em> 协议的简单文档。或者你可以访问<a href="https://android.googlesource.com/platform/development/+/master/cmds/monkey/README.NETWORK.txt" target="_blank" rel="noopener">这里</a>。</p>
<p>下面简单概括一下文档内容：</p>
<h2 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h2><p><code>monkey --port</code> 命令会让 monkey server 运行起来，并监听特定的端口：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell monkey --port 1080</span><br></pre></td></tr></table></figure>
<p>那么我在 host 机器上就可以通过 TCP 连接来向 monkey server 发送命令。注意 monkey server 只会绑定 localhost。TCP 协议是 ADB 支持的，因此需要设置端口转发：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:1080 tcp:1080</span><br></pre></td></tr></table></figure>
<p>这样就可以向 monkey server 发送命令了。</p>
<h2 id="协议格式"><a href="#协议格式" class="headerlink" title="协议格式"></a>协议格式</h2><p>不同的命令之间通过换行来分隔。对于正常完成的命令，monkey 会回复 OK；否则会回复 ERROR。如果命令有返回值，返回值会放在与 OK 或 ERROR 的同一行，以冒号分隔。ERROR 回复的返回值一般是错误消息。下面是一个请求-响应序列的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">key down menu</span><br><span class="line">OK</span><br><span class="line">touch monkey</span><br><span class="line">ERROR: monkey not a number</span><br><span class="line">getvar sdk</span><br><span class="line">OK: donut</span><br><span class="line">getvar foo</span><br><span class="line">ERROR: no such var</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2019/Monkey-inject-events-with-Automated-Network-Control/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2019/A-mistake-on-Git-usage-in-an-open-source-project/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2019/A-mistake-on-Git-usage-in-an-open-source-project/" itemprop="url">记一次开源项目中使用 Git 犯错的经历</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-03T15:07:27+00:00">
                2019-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2019/A-mistake-on-Git-usage-in-an-open-source-project/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2019/A-mistake-on-Git-usage-in-an-open-source-project/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>最近在<a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">掘金翻译计划</a>上参与翻译，这也是我第一次参与正式的开源项目。虽然这不是一个编程的项目，但也会使用 GitHub 的 issue / branch / pull request 这些工具来进行协作。我在一次更新分支的时候，push 了一些不必要的 commits。好在我仔细分析，然后在十分钟之内解决了问题。这是我第一次在正式的开源项目中遇到 Git 相关的挑战，想想也挺有趣的。在这里写篇文章记录一下。</p>
<p>首先介绍一下这个翻译项目的工作流程。项目的主分支是 master，当认领一篇文章进行翻译的时候，需要创建一个新分支 <code>translate/file-name.md</code>，翻译完成后需要创建一个 pull request 以供 review（也就是校对）。校对的主要过程是对 pull request 中内容进行评论。而校对之后，译者根据校对意见进行修改的时候，只需要直接提交到原分支，GitHub 就会自动将修改的内容同步到 pull request 中，非常方便。可以看到，整个项目其实和编程项目的工作方式类似，只不过你提交的不是源代码，而是翻译过的 markdown 文章。</p>
<h2 id="漫不经心的错误"><a href="#漫不经心的错误" class="headerlink" title="漫不经心的错误"></a>漫不经心的错误</h2><p>言归正传。我一共翻译了两篇文章，不妨称为 A 和 B。这样我就需要从 <code>master</code> 分支分出两个新分支：<code>translate/A.md</code> 和 <code>translate/B.md</code>。由于我两次翻译的间隔时间较短，<strong>在我创建分支 B 的时候，分支 A 还没有被 merge 到 master</strong>（这是重点）。也就是说，B 分支中的文件是没有我已翻译好的 A 文章的。</p>
<p>终于我的 B 文章也翻译完了，而且两位认真的校对者也在 pull request 中提出了自己的校对意见。我翻译文章 B 本来一直是在我的笔记本电脑上进行的。当我想要根据校对意见进行最后一次修改的时候，我突然决定直接在手边的台式机上干这些活！这当然是完全可以的，只是有点麻烦。我的台式机上有 <code>translate/A.md</code> 分支的所有内容，但很明显没有 <code>translate/B.md</code> 分支。于是我很自然地从 GitHub 上同步新的 B 分支：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b translation/B.md</span><br><span class="line">git pull origin translation/B.md</span><br></pre></td></tr></table></figure>
<p>然而我犯了一个致命的错误，我本该从 master 分支上分出 B 分支的，但是我没有注意到当前分支是 A 分支。于是，<strong>我从 A 分支上分出了 B 分支</strong>！</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2019/A-mistake-on-Git-usage-in-an-open-source-project/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2019/Tutorial-Write-a-Shell-in-C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2019/Tutorial-Write-a-Shell-in-C/" itemprop="url">[译] 教程 - 用 C 写一个 Shell</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-25T20:32:18+00:00">
                2019-02-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2019/Tutorial-Write-a-Shell-in-C/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2019/Tutorial-Write-a-Shell-in-C/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>这是我在<strong>掘金翻译计划</strong>中的译文。 译文链接：<a href="https://juejin.im/post/5c73dd7d6fb9a049aa6fb9aa" target="_blank" rel="noopener">[译] 教程 - 用 C 写一个 Shell</a></p>
<ul>
<li>原文地址：<a href="https://brennan.io/2015/01/16/write-a-shell-in-c/" target="_blank" rel="noopener">Tutorial - Write a Shell in C</a></li>
<li>原文作者：<a href="https://brennan.io" target="_blank" rel="noopener">Stephen Brennan</a></li>
<li>译文出自：<a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">掘金翻译计划</a></li>
<li>本文永久链接：<a href="https://github.com/xitu/gold-miner/blob/master/TODO1/tutorial-write-a-shell-in-c.md" target="_blank" rel="noopener">https://github.com/xitu/gold-miner/blob/master/TODO1/tutorial-write-a-shell-in-c.md</a></li>
<li>译者：<a href="https://github.com/nettee" target="_blank" rel="noopener">nettee</a></li>
<li>校对者：<a href="https://github.com/kasheemlew" target="_blank" rel="noopener">kasheemlew</a>，<a href="https://github.com/JackEggie" target="_blank" rel="noopener">JackEggie</a></li>
</ul>
<hr>
<p>你很容易认为自己“不是一个<strong>真正的</strong>程序员”。有一些程序所有人都用，它们的开发者很容易被捧上神坛。虽然开发大型软件项目并不容易，但很多时候这种软件的基本思想都很简单。自己实现这样的软件是一种证明自己可以是真正的程序员的有趣方式。所以，这篇文章介绍了我是如何用 C 语言写一个自己的简易 Unix shell 的。我希望其他人也能感受到这种有趣的方式。</p>
<p>这篇文章中介绍的 shell（叫做 <code>lsh</code>），可以在 <a href="https://github.com/brenns10/lsh" target="_blank" rel="noopener">GitHub</a> 上获取它的源代码。</p>
<p><strong>学校里的学生请注意！</strong> 许多课程都有要求你编写一个 shell 的作业，而且有些教师都知道这样的教程和代码。如果你是此类课程上的学生，请不要在未经允许的情况下复制（或复制加修改）这里的代码。我<a href="https://brennan.io/2016/03/29/dishonesty/" target="_blank" rel="noopener">建议</a>反对重度依赖本教程的行为。</p>
<h3 id="Shell-的基本生命周期"><a href="#Shell-的基本生命周期" class="headerlink" title="Shell 的基本生命周期"></a>Shell 的基本生命周期</h3><p>让我们自顶向下地观察一个 shell。一个 shell 在它的生命周期中主要做三件事。</p>
<ul>
<li><strong>初始化</strong>：在这一步中，shell 一般会加载并执行它的配置文件。这些配置会改变 shell 的行为。</li>
<li><strong>解释执行</strong>：接着，shell 会从标准输入（可能是交互式输入，也可能是一个文件）读取命令，并执行这些命令。</li>
<li><strong>终止</strong>：当命令全部执行完毕，shell 会执行关闭命令，释放所有内存，然后终止。</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2019/Tutorial-Write-a-Shell-in-C/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2018/Java-8-default-Method-and-Multiple-Inheritance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2018/Java-8-default-Method-and-Multiple-Inheritance/" itemprop="url">Java 8： 事实上的多继承语言</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-26T20:38:57+00:00">
                2018-12-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2018/Java-8-default-Method-and-Multiple-Inheritance/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2018/Java-8-default-Method-and-Multiple-Inheritance/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><strong>Java 在多重继承上的设计甚至不如 C++</strong>。这个论点让人很难接受，毕竟我们在第一堂 Java 课上学到了：“Java 的优越性之一是摒除了 C++ 中易出错的多重继承”。然而，Java 的类单继承、接口多继承的设计，最终使 Java 走上了多重继承的老路，这最后一根稻草就是 Java 8 的 <code>default</code> 关键字。</p>
<h2 id="Java-为什么设计成单继承"><a href="#Java-为什么设计成单继承" class="headerlink" title="Java 为什么设计成单继承"></a>Java 为什么设计成单继承</h2><p>Java 语言在设计之初显然受到了 C++ 的很大影响。然而，Java 最终却没有采用 C++ 的多重继承方案。这是 Java 与 C++ 区分开的一个特点。在 Java 中，不允许“实现多继承”，即一个类不允许继承多个父类。但是 Java 允许“声明多继承”，即一个类可以实现多个接口，一个接口也可以继承多个父接口。由于接口只允许有方法声明而不允许有方法实现，这就避免了 C++ 中多继承的决议问题。</p>
<p>James Gosling 在设计 Java 的继承方案时，借鉴了 Objective-C 中的“纯接口”概念。他发现，没有实现体的纯接口避免了 C++ 中的很多歧义和坑。因此 Java 引入了 interface。</p>
<h2 id="Java-8：default-关键字的引入"><a href="#Java-8：default-关键字的引入" class="headerlink" title="Java 8：default 关键字的引入"></a>Java 8：default 关键字的引入</h2><p>Java 8 这一版本可以说是 Java 5 之后一次最大的改动了。在全面引入了 lambda 和函数式编程之后，JDK 中的很多接口也需要升级，例如 <code>Iterable.forEach</code>:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> public interface Iterable&lt;T&gt; &#123;</span><br><span class="line">     Iterator&lt;T&gt; iterator();</span><br><span class="line"><span class="addition">+    void forEach(Consumer&lt;? super T&gt; action);</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>然而，如果直接在 <code>Iterable</code> 接口中添加 <code>forEach</code> 方法。在 Java 7 及以前的所有实现 <code>Iterable</code> 的类都无法通过编译。为了向后兼容已有的代码，Java 8 引入了 <code>default</code> 关键字以及 default method，用来在接口中定义一个有方法体的方法。通过定义一个 default 的 <code>forEach</code>。所有实现了 <code>Iterable</code> 的类无需修改代码，便可在对象上调用 <code>forEach</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">Iterator&lt;T&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">forEach</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; action)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(action);</span><br><span class="line">        <span class="keyword">for</span> (T t : <span class="keyword">this</span>) &#123;</span><br><span class="line">            action.accept(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="default-与多重继承"><a href="#default-与多重继承" class="headerlink" title="default 与多重继承"></a>default 与多重继承</h2>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2018/Java-8-default-Method-and-Multiple-Inheritance/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2018/What-is-Systems-Programming-Really/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2018/What-is-Systems-Programming-Really/" itemprop="url">到底什么是系统编程？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-28T13:54:05+00:00">
                2018-11-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2018/What-is-Systems-Programming-Really/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2018/What-is-Systems-Programming-Really/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>此文翻译自 Will Crichton 的博客中 2018 年 9 月 9 日的一篇文章。</p>
<p>原文：<a href="http://willcrichton.net/notes/systems-programming/" target="_blank" rel="noopener">What is Systems Programming, Really?</a></p>
<p>翻译者：<a href="http://nettee.github.io/" target="_blank" rel="noopener">nettee</a></p>
<p>译者前言：Go 语言诞生也将近十年了，但它的发展并没有很多人当时期望的那样如火如荼。按照 Go 是 “系统语言”的说法以及 Go 的语法设计，它似乎是以取代 C/C++ 为目标的。然而现如今 Go 没有撼动 C/C++ 一丝一毫的地位，倒是取代了一些 Python 在服务器端的工作。但 Go 语言的作者仍然坚称 Go 是“系统语言”。我们该如何看待“系统语言”这个术语？我们又该如何理解 Go 语言和最近流行的 Rust 语言的定位？我们究竟要不要学习它们？学习它们的什么地方？这篇文章梳理了程序语言的发展历史，能够给我们一个思路。</p>
<hr>
<p>前言：我对“系统编程” (systems programming) 这个词不太满意。对我而言，它实际上把两个概念混为一谈：“底层编程”（关注机器的实现细节），以及“系统设计”（创建并管理一系列复杂的交互的组件）。为什么会这样？这种情况持续了多久？重新定义“系统”这个概念，我们会得到什么启发？</p>
<h1 id="1970-年代：汇编之上的改进"><a href="#1970-年代：汇编之上的改进" class="headerlink" title="1970 年代：汇编之上的改进"></a>1970 年代：汇编之上的改进</h1><p>让我们回到现代计算机系统诞生的时候，看看这个术语是如何改变的。我不知道是谁最先创造了这个词语，但我发现对于“计算机系统”的定义始于 70 年代初期。在 <a href="https://www.sciencedirect.com/science/article/pii/S0065245808605100" target="_blank" rel="noopener">系统编程语言</a> (Bergeron et al. 1972) 中，作者写道：</p>
<blockquote>
<p>系统软件是一些子软件的集合。这些子软件形成一个整体，超过部分之和，并使整体有相当大的规模和复杂性。典型的例子包括 multiprogramming、翻译、模拟、信息管理、time sharing 的系统。[…] 下面是系统软件的几个特性。系统软件不必包含所有的特性，而且一些特性也会出现在非系统软件中。</p>
<ol>
<li>需要解决的问题内涵广泛，由许多（而且常常是多种多样）的子问题组成。 </li>
<li>系统程序可能是用于支持其他的软件和应用程序，也可能本身就是一个完整的应用程序。</li>
<li>它是为持续的“产业”使用而设计，而不是针对单个应用程序问题的一次性解决方案。</li>
<li>它可以持续地演化，支持不同数量和种类的特性。</li>
<li>系统程序无论是模块内还是模块间（即“通信”），都需要遵循一定的规则或结构。它常常是由多人设计并实现的。</li>
</ol>
</blockquote>
<p>这个定义还是比较合理的：计算机系统是大规模的、长期使用的、随时间变化的。然而，虽然定义中大部分是描述性的，有一个关键点却是限定性的：提倡区分底层语言和系统语言（在当时，也就是指区分汇编和 FORTRAN）。</p>
<blockquote>
<p>系统编程语言的目标是可以在不过分关注底层细节的情况下使用，但编译得到的底层代码不会比直接手写的差。这种语言需要结合高级语言的简洁性和可读性，以及汇编语言的时间空间效率、深入机器和操作系统的能力。它应该能在不带来额外系统资源开销的前提下，尽量减少设计、编写、调试的时间。</p>
</blockquote>
<p>与此同时，CMU 的研究人员发表了 <a href="https://www2.cs.arizona.edu/classes/cs520/spring06/bliss.pdf" target="_blank" rel="noopener">BLISS: 一个系统编程语言</a> (Wulf et al. 1972)，将其描述为：</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2018/What-is-Systems-Programming-Really/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2018/What-happens-when-return-an-object-by-value-in-Cpp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2018/What-happens-when-return-an-object-by-value-in-Cpp/" itemprop="url">C++ 函数可以直接返回一个对象吗？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-16T19:16:21+00:00">
                2018-11-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2018/What-happens-when-return-an-object-by-value-in-Cpp/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2018/What-happens-when-return-an-object-by-value-in-Cpp/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>内存和资源管理是 C++ 最强的能力之一，也是 C++ 最复杂和最需要思考的地方。写 Java 的时候，我们只需要无脑地把所有对象都 <code>new</code> 出来。反正所有的对象只能放在堆区，又反正又垃圾回收器帮我们管理内存。然而，在 C++ 中，我们需要思考是把对象放在栈上，还是用 <code>new</code> 把对象放在堆上。默认情况下，对象会放在栈上，这样的好处是我们不会忘记释放对象的内存而造成内存泄漏。不过如果我们把一个大对象放在栈上，又将其作为参数或者返回值传递，就必须要考虑对象拷贝的开销了。C++ 由于和 C 兼容，默认情况下参数是按值传递 (call by value) 的，在传递参数和返回值的时候都会拷贝一遍对象。对于参数，我们尚可以将参数声明为引用类型 <code>T&amp;</code> 来避免对象拷贝。而对于返回值的拷贝开销，则是不能声明为引用类型来解决的。</p>
<h1 id="何时必须返回一个对象"><a href="#何时必须返回一个对象" class="headerlink" title="何时必须返回一个对象"></a>何时必须返回一个对象</h1><p>假设我们想写一个 <code>range</code> 函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; range(<span class="keyword">int</span> begin, <span class="keyword">int</span> end, <span class="keyword">int</span> step=<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = begin; i &lt; end; i += step) &#123;</span><br><span class="line">        res.push_back(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码会返回一个 <code>vector&lt;int&gt;</code> 对象，也就是我们不希望看到的：放在栈上的大对象。调用这个函数会产生返回值的临时对象，从而需要拷贝列表中的所有元素。很显然，你不能直接把返回值类型改成 <code>vector&lt;int&gt;&amp;</code> 来避免对象拷贝——编译器会产生一个警告：<code>warning: reference to local variable ‘res’ returned</code>，你返回了一个临时变量的引用，这个引用指向了一个栈上的地址，而这个地址随时可能被回收。这也是 C++ 初学者容易犯的一个错误。既然不能返回一个引用，又想避免对象拷贝的开销，很多“老” C++ 程序员会进行一个人肉优化：把返回值作为引用参数传进去。按这种方法，<code>range()</code> 函数可以改写如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; range(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; out, <span class="keyword">int</span> begin, <span class="keyword">int</span> end, <span class="keyword">int</span> step=<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = begin; i &lt; end; i += step) &#123;</span><br><span class="line">        out.push_back(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Caller</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; r;</span><br><span class="line">range(r, <span class="number">0</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p>C/C++ 程序员可能非常习惯这样写。然而，必须承认这是一个丑陋的写法。那么，直接返回一个 <code>vector&lt;int&gt;</code> 对象到底会怎么样呢？对象拷贝的开销能否避免？</p>
<h1 id="临时对象与返回值优化"><a href="#临时对象与返回值优化" class="headerlink" title="临时对象与返回值优化"></a>临时对象与返回值优化</h1><p>根据 《深度探索 C++ 对象模型》第 2.3 节 “程序转化语意学” (Program Transformation Semantics) 所述，函数的返回值会做如下转化：</p>
<ol>
<li>添加一个临时变量 <code>__result</code></li>
<li>当函数返回时，调用 <code>__result</code> 的 copy constructor，使用返回值 <code>x</code> 作为参数</li>
<li>（如果有的话）对 <code>__result</code> 进行后续操作</li>
</ol>
<p>注意，后续操作中还能包括更多的 constructor，例如我们调用 <code>range</code> 函数以初始化变量 <code>r1</code>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; r1;</span><br><span class="line">r1 = range(<span class="number">1</span>, <span class="number">10</span>); <span class="comment">// 调用 r1 的 copy assignment operator (即 operator=)</span></span><br></pre></td></tr></table></figure>
<p>可以看到，虽然只是简单的一次函数调用，临时对象就进行了两次拷贝。而 <code>range</code> 产生的数越多，需要拷贝的内容就越多，对性能的影响就越大。</p>
<p>为了解决这个问题，很多 C++ 编译器都实现了 <a href="https://en.wikipedia.org/wiki/Copy_elision#Return_value_optimization" target="_blank" rel="noopener">返回值优化</a> (Return Value Optimization)，来消除返回值临时对象的多次拷贝。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2018/What-happens-when-return-an-object-by-value-in-Cpp/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/posts/2018/Understanding-lvalues-and-rvalues-in-C-and-C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nettee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nettee 的 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/posts/2018/Understanding-lvalues-and-rvalues-in-C-and-C/" itemprop="url">理解 C/C++ 中的左值和右值</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-16T19:58:54+00:00">
                2018-10-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/2018/Understanding-lvalues-and-rvalues-in-C-and-C/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="posts/2018/Understanding-lvalues-and-rvalues-in-C-and-C/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>本文翻译自 Eli Bendersky’s website。</p>
<p>原文：<a href="https://eli.thegreenplace.net/2011/12/15/understanding-lvalues-and-rvalues-in-c-and-c" target="_blank" rel="noopener">Understanding lvalues and rvalues in C and C++</a></p>
<p>翻译者：<a href="http://nettee.github.io" target="_blank" rel="noopener">nettee</a></p>
<hr>
<p>我们在 C/C++ 编程中并不会经常用到 <em>左值 (lvalue)</em> 和 <em>右值 (rvalue)</em> 两个术语。然而一旦遇见，又常常不清楚它们的含义。最可能出现两这个术语的地方是在编译错误或警告的信息中。例如，使用 <code>gcc</code> 编译以下代码时：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="number">2</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    foo() = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你会得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test.c: In function &apos;main&apos;:</span><br><span class="line">test.c:8:5: error: lvalue required as left operand of assignment</span><br></pre></td></tr></table></figure>
<p>没错，这个例子有点夸张，不像是你能写出来的代码。不过错误信息中提到了左值 (lvalue)。另一个例子是当你用 <code>g++</code> 编译以下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>&amp; <span class="title">foo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在错误信息是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">testcpp.cpp: In function &apos;int&amp; foo()&apos;:</span><br><span class="line">testcpp.cpp:5:12: error: invalid initialization of non-const reference of type &apos;int&amp;&apos; from an rvalue of type &apos;int&apos;</span><br></pre></td></tr></table></figure>
<p>同样的，错误信息中提到了术语右值 (rvalue)。那么，在 C 和 C++ 中，<em>左值</em> 和 <em>右值</em> 到底是什么意思呢？我这篇文章将会详细解释。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/2018/Understanding-lvalues-and-rvalues-in-C-and-C/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars2.githubusercontent.com/u/3953668?s=460&v=4"
                alt="nettee" />
            
              <p class="site-author-name" itemprop="name">nettee</p>
              <p class="site-description motion-element" itemprop="description">持续学习中...</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/nettee" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:nettee.liu@gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://juejin.im/user/5c68d1196fb9a04a0164de03" target="_blank" title="掘金">
                    
                      <i class="fa fa-fw fa-globe"></i>掘金</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/nettee" target="_blank" title="知乎">
                    
                      <i class="fa fa-fw fa-globe"></i>知乎</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nettee</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://nettee.disqus.com/count.js" async></script>
    

    

  




	





  














  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  


  

  

</body>
</html>
